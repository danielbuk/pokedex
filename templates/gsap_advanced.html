<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Pokedex N√≠vel Lend√°rio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_advanced.css') }}">
</head>
<body>
    <section class="hero-section" id="hero">
        <div class="hero-content">
            <h1 class="hero-title" id="heroTitle">POKEDEX LEND√ÅRIA</h1>
            <p class="hero-subtitle" id="heroSubtitle">Explore o mundo Pok√©mon com anima√ß√µes de n√≠vel profissional.</p>
            <button class="cta-button" id="ctaButton">Explorar Pok√©mon</button>
        </div>
    </section>

    <section class="content-section" id="content">
        <div class="container">
            <h2 class="section-title">Encontre seu Pok√©mon</h2>
            <p class="section-subtitle">Abaixo est√° a lista dos 151 Pok√©mon originais. Clique para ver os detalhes.</p>
            
            <div id="pokemon-grid">
                <div class="loader-container">
                    <div class="loader-spinner"></div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

            // --- ANIMA√á√ÉO DA SE√á√ÉO HERO ---
            const heroTimeline = gsap.timeline();
            heroTimeline
                .from("#heroTitle", { opacity: 0, y: -50, duration: 1, ease: "power2.out" })
                .from("#heroSubtitle", { opacity: 0, y: 50, duration: 1, ease: "power2.out" }, "-=0.7")
                .from("#ctaButton", { opacity: 0, scale: 0.8, duration: 0.8, ease: "back.out(1.7)" }, "-=0.5");

            // --- BOT√ÉO "EXPLORAR POK√âMON" ---
            document.getElementById("ctaButton").addEventListener("click", () => {
                gsap.to(window, {
                    duration: 1.5,
                    scrollTo: "#content",
                    ease: "power2.inOut"
                });
            });

            // --- N√çVEL ABSURDO: CARREGAMENTO DIN√ÇMICO ---
            const pokemonGrid = document.getElementById('pokemon-grid');

            const fetchAndDisplayPokemon = async () => {
                try {
                    const response = await fetch('/api/lista?limit=151');
                    if (!response.ok) throw new Error('Erro na rede!');
                    
                    const data = await response.json();
                    const pokemonPromises = data.results.map(p => fetch(`/api/pokemon/${p.id}`).then(res => res.json()));
                    const allPokemonData = await Promise.all(pokemonPromises);
                    
                    pokemonGrid.innerHTML = ''; // Limpa o loader

                    allPokemonData.forEach(pokemon => {
                        const typesHtml = pokemon.tipos.map(type => `<span class="type-badge type-${type}">${type}</span>`).join('');
                        
                        const card = document.createElement('div');
                        card.className = 'pokemon-card';
                        card.innerHTML = `
                            <div class="pokemon-card-id">#${String(pokemon.id).padStart(3, '0')}</div>
                            <img src="${pokemon.sprites.front_default}" alt="${pokemon.nome}" class="pokemon-card-sprite">
                            <h3 class="pokemon-card-name">${pokemon.nome}</h3>
                            <div class="pokemon-card-types">${typesHtml}</div>
                        `;
                        
                        // Adiciona evento de clique para ir para a p√°gina de detalhes
                        card.addEventListener('click', () => {
                            window.location.href = `/pokemon/${pokemon.id}`;
                        });

                        pokemonGrid.appendChild(card);
                    });

                    // Anima os cards rec√©m-criados
                    gsap.from(".pokemon-card", {
                        opacity: 0,
                        y: 50,
                        duration: 0.5,
                        stagger: 0.05,
                        ease: "power2.out"
                    });

                } catch (error) {
                    pokemonGrid.innerHTML = '<p style="color: var(--pokemon-red); text-align: center; grid-column: 1 / -1;">Falha ao carregar Pok√©mon. Tente recarregar a p√°gina.</p>';
                    console.error("Erro ao buscar Pok√©mon:", error);
                }
            };

            fetchAndDisplayPokemon();
        });
    </script>
</body>
</html>